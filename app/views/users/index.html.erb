<h1>Users#index</h1>

<h1 class="text-2xl font-bold mb-3">All Users</h1>
<p class="text-base leading-relaxed text-gray-700">
  Hi <%= Current.user.email_address %>, please select your friends
</p>


<%# --- Section 1: Pending Requests You Received (Decline them) --- %>
  <h2 class="text-xl font-bold mb-3 mt-6">Pending Friend Requests</h2>
  <ul class="list-disc list-inside pl-5 space-y-2">
    <%# Loop over the friendship records directly to get their IDs %>
    <% Current.user.pending_friendships.each do |friendship| %>
      <li>
        <span><%= friendship.user.email_address %></span>
        <%# This button accepts the request (uses the UPDATE action) %>
        <%= button_to "Accept", friendship_path(friendship.user), method: :patch, class: "btn btn-xs btn-success" %>
        <%# This button DECLINES the request (uses the DESTROY action) %>
        <%= button_to "Decline", friendship_path(friendship), method: :delete, class: "btn btn-xs btn-error", data: { confirm: 'Are you sure you want to decline this request?' } %>
      </li>
    <% end %>
  </ul>


<%# --- Section 2: Requests You Sent (Cancel them) --- %>
  <h2 class="text-xl font-bold mb-3 mt-6">Sent Friend Requests</h2>
  <ul class="list-disc list-inside pl-5 space-y-2">
    <%# Loop over the requested_friendships records directly %>
    <% Current.user.requested_friendships.each do |friendship| %>
      <li>
        <span><%= friendship.friend.email_address %> (Pending)</span>
        <%# This button CANCELS your sent request (uses the DESTROY action) %>
        <%= button_to "Cancel Request", friendship_path(friendship), method: :delete, class: "btn btn-error button-outline", data: { confirm: 'Are you sure you want to cancel this friend request?' } %>
      </li>
    <% end %>
  </ul>

<%# --- Section 3: Your Accepted Friends --- %>
<h2 class="text-xl font-bold mb-3 mt-6">Friends</h2>
<ul class="list-disc list-inside pl-5 space-y-2">
  <% Current.user.friends.each do |friend| %>
    <li>
      <span><%= friend.email_address %></span>
      <%# You might add an "Unfriend" button here later, which would also use the DESTROY action %>
    </li>
  <% end %>
</ul>

<h2 class="text-xl font-bold mb-3 mt-6">Other users</h2>
<ul class="list-disc list-inside pl-5 space-y-2">
<% @users.each do |user| %>
  <% unless Current.user == user || Current.user.friends_with?(user) || Current.user.requested_friends.include?(user) || Current.user.pending_friends.include?(user) %>
  <li>
    <%= user.email_address %>
      <%= button_to "Add Friend", friendships_path(friend_id: user.id), method: :post, class: "btn btn-success"%>
  </li>
  <% end %>
<% end %>
</ul>
